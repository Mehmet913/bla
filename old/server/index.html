<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>moo</title>
  <style>
    table  {border: 1px solid #555; border-collapse: collapse; text-align: center; font-size: 1.1em;}
    tr     {border: 1px solid #BBB;}
    th     {background-color: #CDF;}
    th, td {padding: .4em .8em;}
    tr:nth-child(odd) {background-color: #DDD}
  </style>
  <script src="https://unpkg.com/react@15.3.2/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-core@5.8.38/browser.min.js"></script>
  <script src="https://unpkg.com/jquery@3.1.0/dist/jquery.min.js"></script>
</head>

<body>
  <div id="content"></div>
  <script type="text/babel">
    var Moos = React.createClass({
      getInitialState: function() {
        return {moos: undefined};
      },
      componentDidMount: function() {
        var _this = this;
        (function doQuery() {
          jQuery.ajax('/api/total').done(function(res) {
            _this.setState({moos: res.totalMoos + res.totalMoosTriggered + res.totalBigMoosTriggered});
          });
          setTimeout(doQuery, 60000);
        })();
      },
      render: function() {
        return (
          <div>
            <h1>There have been {this.state.moos || '...'} moos</h1>
          </div>
        );
      }
    });

    var SteamLeaderboards = React.createClass({
      getInitialState: function() {
        return {cows: undefined};
      },
      componentDidMount: function() {
        var _this = this;
        (function doQuery() {
          jQuery.ajax('/api/steamLeaderboards')
            .done(function(res) {
              console.log('Got Steam response:', res);
              window.steamRes = res;
              _this.setState({cows: res});
            });
          setTimeout(doQuery, 60000);
        })();
      },
      render: function() {
        if (!this.state.cows)
          return <div><h3>Steam Leaderboards</h3><b>Loading...</b></div>;

        return (
          <div>
            <h3>Steam Leaderboards</h3>
            <table><tbody>
              <tr>
                <th>#</th>
                <th>User</th>
                <th>Points</th>
                <th>Moos</th>
                <th>Moos Triggered</th>
                <th>MOOs Triggered</th>
              </tr>
              {this.state.cows.map(function(cow, index) {
                return (
                  <tr key={index}>
                    <td>{index+1}.</td>
                    <td>{cow.userId}</td>
                    <td>{cow.currency}</td>
                    <td>{cow.totalMoos}</td>
                    <td>{cow.totalMoosTriggered}</td>
                    <td>{cow.totalBigMoosTriggered}</td>
                  </tr>
                );
              })}
            </tbody></table>
          </div>
        );
      }
    });

    var DiscordLeaderboards = React.createClass({
      getInitialState: function() {
        return {cows: undefined};
      },
      componentDidMount: function() {
        var _this = this;
        (function doQuery() {
          jQuery.ajax('/api/discordLeaderboards')
            .done(function(res) {
              console.log('Got Discord response:', res);
              window.discordRes = res;
              _this.setState({cows: res});
            });
          setTimeout(doQuery, 60000);
        })();
      },
      render: function() {
        if (!this.state.cows)
          return <div><h3>Discord Leaderboards</h3><b>Loading...</b></div>;

        return (
          <div>
            <h3>Discord Leaderboards</h3>
            <table><tbody>
              <tr>
                <th>#</th>
                <th>User</th>
                <th>Points</th>
                <th>Moos</th>
                <th>Moos Triggered</th>
                <th>MOOs Triggered</th>
              </tr>
              {this.state.cows.map(function(cow, index) {
                return (
                  <tr key={index}>
                    <td>{index+1}.</td>
                    <td>{cow.userId}</td>
                    <td>{cow.currency}</td>
                    <td>{cow.totalMoos}</td>
                    <td>{cow.totalMoosTriggered}</td>
                    <td>{cow.totalBigMoosTriggered}</td>
                  </tr>
                );
              })}
            </tbody></table>
          </div>
        );
      }
    });

    ReactDOM.render(
      <div>
        <Moos/>
        <SteamLeaderboards/>
        <DiscordLeaderboards/>
      </div>,
      document.getElementById('content'));
  </script>
</body>
</html>
